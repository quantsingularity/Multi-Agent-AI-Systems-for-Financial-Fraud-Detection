apiVersion: v1
kind: ConfigMap
metadata:
  name: fraud-detection-config
  namespace: fraud-detection
data:
  # Redis Configuration
  redis-host: "redis-master.fraud-detection.svc.cluster.local"
  redis-port: "6379"

  # Model Configuration
  model-version: "1.0.0"
  model-path: "/app/models/production"
  ensemble-weights: "0.3,0.7" # IsolationForest, XGBoost

  # Fraud Detection Thresholds
  fraud-threshold: "0.5"
  high-risk-threshold: "0.8"

  # Rate Limiting
  max-flags-per-user-per-day: "10"

  # Performance Settings
  batch-size: "100"
  max-workers: "4"
  prediction-timeout: "1000" # milliseconds

  # Feature Engineering
  feature-window-days: "30"

  # Logging
  log-level: "INFO"
  log-format: "json"

  # Monitoring
  metrics-enabled: "true"
  metrics-port: "9090"

  # A/B Testing
  ab-test-enabled: "true"
  model-b-traffic-percent: "20"

---
apiVersion: v1
kind: Secret
metadata:
  name: fraud-detection-secrets
  namespace: fraud-detection
type: Opaque
stringData:
  # PostgreSQL Database
  postgres-host: "postgres.fraud-detection.svc.cluster.local"
  postgres-port: "5432"
  postgres-database: "fraud_detection"
  postgres-user: "fraud_detection_user"
  postgres-password: "CHANGE_ME_IN_PRODUCTION"

  # Redis (if authentication enabled)
  redis-password: "CHANGE_ME_IN_PRODUCTION"

  # LLM API Keys (optional, for narrative generation)
  openai-api-key: ""
  anthropic-api-key: ""

  # AWS/Cloud Credentials (for model storage)
  aws-access-key-id: ""
  aws-secret-access-key: ""

  # Monitoring & Alerting
  slack-webhook-url: ""
  pagerduty-api-key: ""

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: fraud-detection-models-pvc
  namespace: fraud-detection
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: standard
  resources:
    requests:
      storage: 10Gi

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: fraud-detection-sa
  namespace: fraud-detection

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: fraud-detection-role
  namespace: fraud-detection
rules:
  - apiGroups: [""]
    resources: ["configmaps", "secrets"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: fraud-detection-rolebinding
  namespace: fraud-detection
subjects:
  - kind: ServiceAccount
    name: fraud-detection-sa
    namespace: fraud-detection
roleRef:
  kind: Role
  name: fraud-detection-role
  apiGroup: rbac.authorization.k8s.io
